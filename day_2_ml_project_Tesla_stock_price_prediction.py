# -*- coding: utf-8 -*-
"""Day 2 ML project .ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1pgLFDikWQenfbFfm7dcoe1L3v16JoUty
"""

from google.colab import drive
drive.mount('/content/drive')

"""Tesla stock price prediction"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn import preprocessing
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split
from matplotlib import style
style.use("fivethirtyeight")

df = pd.read_csv("/content/drive/MyDrive/Tesla.csv+-+Tesla.csv.csv")
df.head()

df.info()

df.describe()

df["HL_perc"] = (df["High"] - df["Low"]) / df["Low"] * 100.0
df["OC_perc"] = (df["Close"] - df["Open"]) / df["Open"] * 100.0

dates = np.array(df["Date"])
dates_check = dates[-30:]
dates = dates[:-30]

df = df[["HL_perc", "OC_perc", "Adj Close", "Volume"]]

df["PriceNextMonth"] = df["Adj Close"].shift(-30)

df.tail()

from re import X
x= np.array(df.drop(columns=["PriceNextMonth"]))[:-30]
x = preprocessing.scale(x)
x_predict = x[-30:]
x = x[:-30]
df.dropna(inplace=True)
y = np.array(df["PriceNextMonth"])[:-30]

x_train, x_test, y_train, y_test = train_test_split(x,y,test_size=0.2)

model = RandomForestRegressor()

model.fit(x_train, y_train)

conf = model.score(x_test, y_test)
print(conf)

model.fit(x,y)

predictions = model.predict(x_predict)

actual = pd.DataFrame(dates, columns = ["Date"])
actual["ClosePrice"] = df["Adj Close"]
actual["Forcast"] = np.nan
actual.set_index("Date", inplace=True)
forcast = pd.DataFrame(dates_check, columns = ["Date"])
forcast["Forcast"] = predictions
forcast["ClosePrice"] = np.nan
forcast.set_index("Date", inplace=True)
var = [actual , forcast]
result = pd.concat(var)

result.plot(figsize=(20,10),linewidth=1.5)
plt.legend(loc=2, prop={'size':20})
plt.xlabel('Date')
plt.ylabel('Price')
plt.show()

